# Unity App для OBD2

Этот проект содержит unit-тесты для компонентов OBD2, используя фреймворк Unity.

## Структура проекта

- `src/` - Основной исходный код приложения
- `components/` - Компоненты проекта (iso-tp, phy_interface)
- `tests/` - Unit-тесты
- `Unity-2.6.1/` - Фреймворк Unity для unit-тестирования

## Сборка и запуск тестов

### Объединенный скрипт (рекомендуется)

Для сборки проекта и запуска тестов используйте объединенный скрипт:

```bash
./build_and_run.sh
```

Этот скрипт выполняет все необходимые шаги для сборки проекта и запуска тестов.

### Отдельные скрипты

Также доступны отдельные скрипты для сборки и запуска тестов:

1. Сборка проекта:
   ```bash
   ./build.sh
   ```

2. Запуск тестов:
   ```bash
   ./run_tests.sh
   ```

Примечание: Рекомендуется использовать объединенный скрипт `build_and_run.sh` для сборки и запуска тестов одновременно.

### Отладка в VS Code

Для отладки приложения в среде VS Code:

1. Откройте проект в VS Code
2. Перейдите на вкладку "Run and Debug" (Ctrl+Shift+D)
3. Выберите нужную конфигурацию запуска:
   - "Debug Unity App" для запуска с обычной сборкой
   - "Debug Unity App (Debug Build)" для запуска с отладочной сборкой
4. Нажмите зеленую кнопку запуска или F5 для начала отладки

## Аргументы командной строки для build_and_run.sh

Скрипт `build_and_run.sh` поддерживает следующие аргументы:

- `-d` или `--debug`: Сборка с отладочной информацией
- `-n` или `--no-tests`: Не запускать тесты после сборки
- `-h` или `--help`: Показать справку

Примеры использования:
```bash
# Сборка в режиме отладки без запуска тестов
./build_and_run.sh -d -n

# Сборка в обычном режиме с запуском тестов
./build_and_run.sh
```

## Структура тестов

Тесты организованы по компонентам в директории `tests/`. Каждый компонент имеет свои тесты, которые запускаются через основной runner.

## Интеграционные тесты

Проект также включает интеграционные тесты, которые проверяют взаимодействие компонентов через реальный или виртуальный CAN интерфейс.

### Запуск интеграционных тестов

Интеграционные тесты находятся в директории `tests/integration/` и написаны на Python с использованием библиотек `python-can` и `python-can-isotp`.

Для запуска интеграционных тестов:

```bash
cd tests/integration
python run_integration_tests.py
```

### Требования для интеграционных тестов

- Python 3.6+
- Библиотеки Python: `python-can`, `python-can-isotp`
- Доступ к CAN интерфейсу (реальному или виртуальному)

Установка зависимостей:
```bash
pip install -r tests/integration/requirements.txt
```

### Настройка виртуального CAN интерфейса

```bash
sudo modprobe vcan
sudo ip link add dev vcan0 type vcan
sudo ip link set up vcan0
```

Более подробную информацию см. в [README интеграционных тестов](tests/integration/README.md).

## Тесты с ECU симулятором

Проект также включает специализированные интеграционные тесты, которые взаимодействуют с ECU симулятором для проверки полной функциональности протоколов OBD-II и UDS.

### Запуск тестов с ECU симулятором

Тесты с ECU симулятором находятся в директории `tests/ecu_simulator/`.

Для автоматического запуска тестов с симулятором:

```bash
cd tests/ecu_simulator
./run_with_simulator.sh
```

Этот скрипт автоматически:
1. Настраивает виртуальный CAN интерфейс
2. Запускает ECU симулятор
3. Выполняет интеграционные тесты
4. Останавливает симулятор

### Поддерживаемые тесты

- OBD-II тесты (Service 01, 03, 09)
- UDS тесты (Service 10, 11, 19)
- DTC тесты (кодирование/декодирование)
- Протокольные тесты (ISO-TP, обработка ошибок)

Более подробную информацию см. в [README тестов с ECU симулятором](tests/ecu_simulator/README.md).

## Тестирование с санитайзерами

Проект поддерживает запуск тестов с различными санитайзерами для обнаружения ошибок памяти и неопределенного поведения.

### Поддерживаемые санитайзеры

- **AddressSanitizer (ASan)**: Обнаруживает ошибки работы с памятью
- **UndefinedBehaviorSanitizer (UBSan)**: Обнаруживает неопределенное поведение
- **ThreadSanitizer (TSan)**: Обнаруживает гонки данных в многопоточных приложениях

### Сборка и запуск с санитайзерами

Для сборки и запуска тестов с санитайзерами используется специальный скрипт:

```bash
# Сборка и запуск с AddressSanitizer
./build_with_sanitizers.sh --asan && ./build_sanitizers/unity_app

# Сборка и запуск с UndefinedBehaviorSanitizer
./build_with_sanitizers.sh --ubsan && ./build_sanitizers/unity_app

# Сборка и запуск с ThreadSanitizer
./build_with_sanitizers.sh --tsan && ./build_sanitizers/unity_app
```

### Дополнительная информация

Более подробную информацию о санитайзерах и их использовании см. в [README_SANITIZERS.md](README_SANITIZERS.md).
