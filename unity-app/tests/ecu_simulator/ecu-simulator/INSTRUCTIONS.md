# Инструкции по запуску ECU Simulator

## Решенные проблемы

### 1. ModuleNotFoundError: No module named 'isotp'
Проблема была решена путем установки пакета `can-isotp` вместо `isotp`:
```bash
pip install can-isotp python-can
```

### 2. CanInterfaceNotImplementedError: Unknown interface type "socketcan_native"
Проблема была решена путем изменения типа интерфейса в `loggers/logger_can.py` с `socketcan_native` на `socketcan`.

## Текущий статус

✅ Модуль `isotp` успешно установлен и работает (версия 2.0.7)
✅ ECU симулятор запускается без ошибок импорта
✅ Настроен аппаратный CAN-интерфейс can0
✅ Исправлен тип интерфейса CAN на "socketcan"
❌ Для полной работы симулятора требуются права суперпользователя для загрузки модуля can-isotp

## Как запустить симулятор

### Вариант 1: С правами суперпользователя (рекомендуется)

```bash
sudo python3 ecu_simulator.py
```

Этот вариант автоматически настроит виртуальный CAN-интерфейс и загрузит необходимые модули ядра.

### Вариант 2: Без прав суперпользователя (ограниченная функциональность)

1. Сначала настройте CAN-интерфейс вручную с правами суперпользователя:
   ```bash
   # Для аппаратного интерфейса can0
   sudo sh setup_can.sh can0 500000 /lib/modules/$(uname -r)/kernel/net/can/can-isotp.ko
   ```

2. Затем запустите симулятор без sudo:
   ```bash
   python3 ecu_simulator.py
   ```

## Важные замечания

1. **Путь к модулю can-isotp.ko**: В файле `ecu_config.json` обновлен путь к модулю can-isotp.ko для текущей версии ядра:
   ```json
   "isotp_ko_file_path": {
     "value": "/lib/modules/6.8.0-87-generic/kernel/net/can/can-isotp.ko"
   }
   ```

2. **Тип CAN-интерфейса**: В конфигурации установлен тип "hardware" и интерфейс "can0" для использования аппаратного CAN-интерфейса.

3. **Тип интерфейса python-can**: В файле `loggers/logger_can.py` изменен тип интерфейса с `socketcan_native` на `socketcan` для совместимости с текущей версией python-can.

4. **Зависимости**: Убедитесь, что установлены все необходимые зависимости:
   ```bash
   pip install can-isotp python-can
   ```

## Проверка работы модуля isotp

Для проверки корректной работы модуля `isotp` можно запустить тестовый скрипт:
```bash
python3 test_isotp.py
```

## Дальнейшие шаги

Для полноценной работы симулятора необходимо:
1. Получить права суперпользователя
2. Убедиться, что модули ядра can и can-isotp доступны
3. Настроить аппаратный CAN-интерфейс can0

После этого симулятор будет полностью функционален и сможет обрабатывать OBD и UDS запросы через аппаратный CAN-интерфейс.